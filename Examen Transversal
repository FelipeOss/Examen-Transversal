import datetime
Tipo_Dpto = ['A', 'B', 'C', 'D']
Valor_Dptos = {'A': 3800, 'B': 3000, 'C': 2800, 'D': 3500}

departamentos = [['Disponible'] * 4 for _ in range(10)]
clientes = []
ventas_totales = {'A': 0, 'B': 0, 'C': 0, 'D': 0}

def mostrar_menu():
    print("\n=== Inmobiliaria Casa Feliz ===")
    print("1. Comprar departamento")
    print("2. Mostrar departamentos disponibles")
    print("3. Ver listado de clientes")
    print("4. Mostrar ganancias totales")
    print("5. Salir")

    opcion = input("Seleccione una opción: ")
    return opcion

def validar_run(run):
    run = run.replace(".", "")
    if not run.isdigit() or len(run) < 7:
        return False
    return True

def validar_dpto(opcion_dpto):
    if opcion_dpto in ['A', 'B', 'C', 'D']:
        return True
    return False

def comprar_dpto():
    print("\n=== Comprar Departamento ===")
    piso = int(input("Ingrese el número de piso (1-10): "))
    while piso < 1 or piso > 10:
        print("Piso inválido. Intente nuevamente.")
        piso = int(input("Ingrese el número de piso (1-10): "))

    opcion_dpto = input("Ingrese el tipo de departamento (A, B, C o D): ")
    while not validar_dpto(opcion_dpto):
        print("Tipo de departamento inválido. Intente nuevamente.")
        opcion_dpto = input("Ingrese el tipo de departamento (A, B, C o D): ")

    dpto_index = Tipo_Dpto.index(opcion_dpto)
    dpto_disponible = departamentos[piso - 1][dpto_index]

    if dpto_disponible == 'Disponible':
        run = input("Ingrese el RUN del comprador (sin puntos ni guion, los RUN terminados en K escriben 0): ")
        while not validar_run(run):
            print("RUN inválido. Intente nuevamente.")
            run = input("Ingrese el RUN del comprador (sin puntos ni guion): ")

        departamentos[piso - 1][dpto_index] = 'Vendido'
        clientes.append((run, opcion_dpto + str(piso)))

        precio_departamento = Valor_Dptos[opcion_dpto]
        ventas_totales[opcion_dpto] += precio_departamento

        print("La operación se ha realizado correctamente.")
    else:
        print("El departamento seleccionado no está disponible.")

def Dpto_Disponible():
    print("\n=== Departamentos Disponibles ===")
    for piso in range(1, 10 + 1):
        print(f"Piso {piso}: ", end='')
        for tipo in Tipo_Dpto:
            dpto_index = Tipo_Dpto.index(tipo)
            departamento = departamentos[piso - 1][dpto_index]
            print(f"{tipo}{piso} [{departamento}] ", end='')
        print()

def mostrar_listado_compradores():
    if len(clientes) == 0:
        print("\n=== Listado de Compradores ===")
        print("No hay clientes registrados.")
        return
    
    print("\n=== Listado de Compradores ===")
    compradores_ordenados = sorted(clientes, key=lambda x: int(x[0]))
    for comprador in compradores_ordenados:
        print(f"RUN: {comprador[0]} - Departamento: {comprador[1]}")
    

def mostrar_ganancias_totales():
    print("\n=== Ganancias Totales ===")
    total_ventas = 0
    for tipo in Tipo_Dpto:
        cantidad_ventas = ventas_totales[tipo] // Valor_Dptos[tipo]
        total_tipo = cantidad_ventas * Valor_Dptos[tipo]
        total_ventas += total_tipo
        print(f"Tipo {tipo}: {Valor_Dptos[tipo]} UF - Cantidad: {cantidad_ventas} - Total: {total_tipo} UF")
    print(f"TOTAL: {total_ventas} UF")

def fecha_actual():
    fecha_actual = datetime.datetime.now()
    return fecha_actual.strftime("%d/%m/%Y")

def main():
    while True:
        opcion = mostrar_menu()

        if opcion == '1':
            comprar_dpto()
        elif opcion == '2':
            Dpto_Disponible()
        elif opcion == '3':
            mostrar_listado_compradores()
        elif opcion == '4':
            mostrar_ganancias_totales()
        elif opcion == '5':
            print("\nGracias por comprar en inmobiliaria Casa Feliz.")
            print("Nombre: [Felipe Guajardo]")
            print("Fecha: " + fecha_actual())
            break
        else:
            print("Opción inválida. Intente nuevamente.")

main()
